{% extends 'ToP/admin_dashboard/base_dashboard.html' %}
{% load dashboard_extras %}
{% block title %}{{ model_verbose_name_plural|title }}{% endblock %} 

{% block extra_css %}
<style>
  /* Actions Bar */
  .table-actions {
    background: var(--bg-surface);
    padding: 1rem;
    border-radius: var(--radius);
    margin-bottom: 1.5rem;
    border: 1px solid var(--border-color);
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: center;
    box-shadow: var(--shadow-sm);
  }

  .search-form {
    flex: 1;
    display: flex;
    gap: 0.5rem;
  }

  .search-input {
    flex: 1;
    max-width: 400px;
    padding: 0.6rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    font-size: 0.9rem;
    transition: all 0.2s;
  }
  
  .search-input:focus {
    border-color: var(--primary);
    outline: none;
    box-shadow: 0 0 0 3px var(--primary-light);
  }

  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    padding: 0.6rem 1.25rem;
    border-radius: 0.5rem;
    font-weight: 500;
    font-size: 0.9rem;
    text-decoration: none;
    cursor: pointer;
    border: none;
    transition: all 0.2s;
    gap: 0.5rem;
  }

  .btn-primary { background: var(--primary); color: white; }
  .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
  
  .btn-secondary { background: white; border: 1px solid var(--border-color); color: var(--text-main); }
  .btn-secondary:hover { background: #f9fafb; border-color: #d1d5db; }

  .btn-danger-soft { background: #fef2f2; color: #dc2626; padding: 0.4rem 0.8rem; font-size: 0.8rem; }
  .btn-danger-soft:hover { background: #fee2e2; }

  .btn-edit-soft { background: #eff6ff; color: var(--primary); padding: 0.4rem 0.8rem; font-size: 0.8rem; }
  .btn-edit-soft:hover { background: #dbeafe; }

  /* Table */
  .table-card {
    background: var(--bg-surface);
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    overflow: hidden;
  }

  .table-container { overflow-x: auto; }

  table { width: 100%; border-collapse: collapse; white-space: nowrap; }

  th {
    background: #f9fafb;
    padding: 1rem 1.5rem;
    text-align: left;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-secondary);
    letter-spacing: 0.05em;
    border-bottom: 1px solid var(--border-color);
  }

  td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-main);
    vertical-align: middle;
  }

  tr:last-child td { border-bottom: none; }
  tr:hover td { background-color: #f8fafc; }

  /* Pagination */
  .pagination-wrapper {
    padding: 1rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-surface);
    border-top: 1px solid var(--border-color);
  }

  .pagination { display: flex; gap: 0.25rem; }

  .page-link {
    padding: 0.5rem 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 0.375rem;
    background: white;
    color: var(--text-main);
    text-decoration: none;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .page-link:hover { background: #f3f4f6; }
  .page-link.active { background: var(--primary); color: white; border-color: var(--primary); }
</style>
{% endblock %} 

{% block content %}
<div class="page-header">
  <h1 class="page-title">{{ model_verbose_name_plural|title }}</h1>
  <a href="{% url 'dynamic_model_create' model_name=model_name %}" class="btn btn-primary">
     <span>+</span> Add {{ model_verbose_name|title }}
  </a>
</div>

<div class="table-actions">
  <form method="get" class="search-form">
    <input
      type="text"
      name="q"
      class="search-input"
      placeholder="Search {{ model_verbose_name_plural }}..."
      value="{{ query|default:'' }}"
    />
    <button type="submit" class="btn btn-secondary">Search</button>
    {% if query %}
      <a href="?" class="btn btn-secondary" style="color: var(--danger);">Clear</a>
    {% endif %}
  </form>
</div>

<div class="table-card">
  <div class="table-container">
    <table>
      <thead>
        <tr>
          {% for field in fields %}
          <th>{{ field|replace:"_| " }}</th>
          {% endfor %}
          <th style="text-align: right;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for object in objects %}
        <tr>
          {% for field in fields %}
          <td>
            {# Basic check for boolean values to show icons instead of True/False #}
            {% with value=object|get_attribute:field %}
              {% if value is True %}
                <span style="color: var(--success); background: #ecfdf5; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">Active</span>
              {% elif value is False %}
                <span style="color: var(--text-secondary); background: #f3f4f6; padding: 2px 8px; border-radius: 12px; font-size: 0.8em;">Inactive</span>
              {% else %}
                {{ value|truncatechars:50|default:"-" }}
              {% endif %}
            {% endwith %}
          </td>
          {% endfor %}
          <td style="text-align: right;">
            <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
              <a href="{% url 'dynamic_model_update' model_name=model_name pk=object.pk %}" class="btn btn-edit-soft">Edit</a>
              <a href="{% url 'dynamic_model_delete' model_name=model_name pk=object.pk %}" class="btn btn-danger-soft">Delete</a>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="{{ fields|length|add:1 }}" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
            <div style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;">üîç</div>
            No records found matching your query.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if is_paginated %}
  <div class="pagination-wrapper">
    <div style="font-size: 0.875rem; color: var(--text-secondary);">
      Page <b>{{ page_obj.number }}</b> of <b>{{ page_obj.paginator.num_pages }}</b>
    </div>
    <div class="pagination">
      {% if page_obj.has_previous %}
      <a href="?page=1&q={{ query|default:'' }}" class="page-link">&laquo;</a>
      <a href="?page={{ page_obj.previous_page_number }}&q={{ query|default:'' }}" class="page-link">‚Äπ</a>
      {% endif %}

      <span class="page-link active">{{ page_obj.number }}</span>

      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&q={{ query|default:'' }}" class="page-link">‚Ä∫</a>
      <a href="?page={{ page_obj.paginator.num_pages }}&q={{ query|default:'' }}" class="page-link">&raquo;</a>
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}